<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ChrisslyEngine Documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "ayu" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="overview.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Getting Started</li><li class="chapter-item expanded "><a href="quickstart.html"><strong aria-hidden="true">1.</strong> Quickstart</a></li><li class="chapter-item expanded affix "><li class="part-title">Documentation</li><li class="chapter-item expanded "><a href="toolchain.html"><strong aria-hidden="true">2.</strong> Toolchain</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="toolchain/blender.html"><strong aria-hidden="true">2.1.</strong> Blender</a></li><li class="chapter-item expanded "><a href="toolchain/rawtex_gimp_plugin.html"><strong aria-hidden="true">2.2.</strong> RAWTex Gimp Plugin</a></li><li class="chapter-item expanded "><a href="toolchain/gimp.html"><strong aria-hidden="true">2.3.</strong> Gimp</a></li><li class="chapter-item expanded "><a href="toolchain/cl_tools.html"><strong aria-hidden="true">2.4.</strong> Command line tools</a></li><li class="chapter-item expanded "><a href="toolchain/leveleditor.html"><strong aria-hidden="true">2.5.</strong> Leveleditor</a></li></ol></li><li class="chapter-item expanded "><a href="engine.html"><strong aria-hidden="true">3.</strong> Engine</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="engine/graphics.html"><strong aria-hidden="true">3.1.</strong> Graphics</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="engine/graphics/mesh.html"><strong aria-hidden="true">3.1.1.</strong> Mesh-Format</a></li><li class="chapter-item expanded "><a href="engine/graphics/material.html"><strong aria-hidden="true">3.1.2.</strong> Material-Format</a></li><li class="chapter-item expanded "><a href="engine/graphics/texture.html"><strong aria-hidden="true">3.1.3.</strong> Texture-Format</a></li><li class="chapter-item expanded "><a href="engine/graphics/animation.html"><strong aria-hidden="true">3.1.4.</strong> Skeleton-Animation-Format</a></li><li class="chapter-item expanded "><a href="engine/graphics/cubemap.html"><strong aria-hidden="true">3.1.5.</strong> Cubemaps</a></li><li class="chapter-item expanded "><a href="engine/graphics/shadows.html"><strong aria-hidden="true">3.1.6.</strong> Shadows</a></li><li class="chapter-item expanded "><a href="engine/graphics/defaultshader.html"><strong aria-hidden="true">3.1.7.</strong> Built-in Default Shaders</a></li><li class="chapter-item expanded "><a href="engine/graphics/manual_mesh.html"><strong aria-hidden="true">3.1.8.</strong> Create mesh programmatically</a></li><li class="chapter-item expanded "><a href="engine/graphics/animation_system_gotchas.html"><strong aria-hidden="true">3.1.9.</strong> Animation System Gotchas</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ChrisslyEngine Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="overview"><a class="header" href="#overview">Overview</a></h1>
<p>ChrisslyEngine is a 3D-Rendering/Audio Engine for the Playstation Portable (PSP), Android devices and Windows written in C++.</p>
<h2 id="screenshots"><a class="header" href="#screenshots">Screenshots</a></h2>
<h3 id="playstation-portable"><a class="header" href="#playstation-portable">Playstation Portable</a></h3>
<p><img src="screenshots/screen_animationtest.png" alt="animationtest" />
<img src="screenshots/screen_materialtest.png" alt="materialtest" /></p>
<h3 id="android"><a class="header" href="#android">Android</a></h3>
<p><img src="screenshots/screen_animationtest_android.png" alt="animationtest_android" /></p>
<h2 id="features"><a class="header" href="#features">Features</a></h2>
<h3 id="platform-support"><a class="header" href="#platform-support">Platform Support</a></h3>
<ul>
<li>Playstation Portable</li>
<li>Android</li>
<li>Windows</li>
</ul>
<h3 id="audio"><a class="header" href="#audio">Audio</a></h3>
<ul>
<li>channel management</li>
<li>buffered and streamed playback</li>
<li>3d sound (built-in software implementation wich works with all devices/drivers that support at least stereo output, linear clamped roll-off)</li>
<li>File Format Support
<ul>
<li>RIFF WAVE (*.wav)</li>
<li>Ogg Vorbis (*.ogg)</li>
</ul>
</li>
<li>real-time dsp system</li>
</ul>
<h3 id="graphics"><a class="header" href="#graphics">Graphics</a></h3>
<ul>
<li>Materials
<ul>
<li>C-like syntax material description language that exposes common fixed function operations with support for multi-pass rendering</li>
<li>Shader parameters can be modified in the application using a simple highlevel interface</li>
</ul>
</li>
<li>Animation
<ul>
<li>Skeletal animation with support for weighted blending of multiple animations</li>
<li>Morph animation (linear blends between shape snapshots)</li>
</ul>
</li>
<li>Texture-based shadows</li>
</ul>
<h3 id="tools"><a class="header" href="#tools">Tools</a></h3>
<ul>
<li>Blender Add-on
<ul>
<li>Export to ChrisslyEngine-Mesh (<em>.mesh), ChrisslyEngine-Texture (</em>.tex), ChrisslyEngine-Materialdescription (<em>.material) and ChrisslyEngine-Skeleton (</em>.skeleton) directly from Blender</li>
</ul>
</li>
<li>Command line tools
<ul>
<li>meshtool: Converts Wavefront-ASCII-OBJ (<em>.obj) to ChrisslyEngine-Mesh (</em>.mesh), creating a morphanimation from a series of (*.obj) files is also supported</li>
<li>texturetool: Adds ChrisslyEngine texture header to raw texture data</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quickstart"><a class="header" href="#quickstart">Quickstart</a></h1>
<h2 id="download"><a class="header" href="#download">Download</a></h2>
<p>Download repository as zip <a href="https://bitbucket.org/evolver/chrisslyengine/downloads/">here</a> or clone it with the following command:</p>
<pre><code class="language-bash">git clone https://bitbucket.org/evolver/chrisslyengine.git
</code></pre>
<h2 id="building-and-running-the-windows-sample"><a class="header" href="#building-and-running-the-windows-sample">Building, and running the windows sample</a></h2>
<h3 id="building-the-sample"><a class="header" href="#building-the-sample">Building the sample</a></h3>
<ol>
<li>install Visual Studio 2015 or higher</li>
<li>open 'windows/ChrisslyEngine_Windows.sln', right click 'ChrisslyEngine_Windows' in the project explorer and click 'Build'</li>
<li>run 'windows/exportassets.cmd'</li>
</ol>
<h3 id="running-the-sample"><a class="header" href="#running-the-sample">Running the sample</a></h3>
<ol>
<li>press 'F5' in Visual Studio to start/debug the sample application</li>
</ol>
<h2 id="building-and-running-the-psp-sample"><a class="header" href="#building-and-running-the-psp-sample">Building, and running the psp sample</a></h2>
<h3 id="building-the-sample-1"><a class="header" href="#building-the-sample-1">Building the sample</a></h3>
<ol>
<li>install <a href="http://devkitpro.org/wiki/Getting_Started/devkitPSP">devkitPSP</a></li>
<li>open a commandline, goto 'chrisslyengine\psp' and run 'make' or open 'ChrisslyEngine_PSP.pnproj' and press 'ALT + 1'</li>
<li>run 'psp\exportassets.cmd'</li>
</ol>
<h3 id="running-the-sample-on-a-real-psp"><a class="header" href="#running-the-sample-on-a-real-psp">Running the sample on a real PSP</a></h3>
<ol>
<li>create a new folder 'ms0:/PSP/GAME/ChrisslyEngine_PSP'</li>
<li>copy the 'export' folder and the 'EBOOT.PBP' to the new folder</li>
<li>use <a href="http://wololo.net/hbl">Half-Byte Loader</a> to execute, since the PBP is not signed</li>
</ol>
<h3 id="running-the-sample-on-the-jpcsp-emulator"><a class="header" href="#running-the-sample-on-the-jpcsp-emulator">Running the sample on the JPCSP emulator</a></h3>
<ol>
<li>copy the 'export' folder to 'jpcsp\ms0\PSP\GAME\ChrisslyEngine_PSP'</li>
<li>open JPCSP, then load the EBOOT.PBP with 'Load File' and press 'Run'</li>
</ol>
<h3 id="running-the-sample-on-the-ppsspp-emulator"><a class="header" href="#running-the-sample-on-the-ppsspp-emulator">Running the sample on the PPSSPP emulator</a></h3>
<ol>
<li>copy the 'export' folder to 'ppsspp_win\memstick\PSP\GAME\ChrisslyEngine_PSP'</li>
<li>open PPSSPP, then load the EBOOT.PBP with 'File' -&gt; 'Open'</li>
</ol>
<h2 id="building-and-running-the-android-sample"><a class="header" href="#building-and-running-the-android-sample">Building, and running the android sample</a></h2>
<h3 id="building-the-sample-2"><a class="header" href="#building-the-sample-2">Building the sample</a></h3>
<ol>
<li>edit 'android\ChrisslyEngine_Android\build.cmd'</li>
<li>change 'NDK' variable to point to your NDK installation directory</li>
<li>run 'build.cmd'</li>
<li>run 'exportassets.cmd'</li>
</ol>
<h3 id="running-the-sample-with-eclipse-and-the-android-development-tool-adt"><a class="header" href="#running-the-sample-with-eclipse-and-the-android-development-tool-adt">Running the sample with Eclipse and the Android Development Tool (ADT)</a></h3>
<ol>
<li>install eclipse and adt as described <a href="http://developer.android.com/ndk/guides/setup.html">here</a></li>
<li>open eclipse</li>
<li>'File' -&gt; 'Import' -&gt; 'Existing Projects into Workspace'</li>
<li>select 'android\ChrisslyEngine_Android' and click 'Finish'</li>
<li>right click the application in the project explorer 'Run As' -&gt; '1 Android Application'</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="toolchain"><a class="header" href="#toolchain">Toolchain</a></h1>
<p>Internal and external tools used for working with the engine.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="blender"><a class="header" href="#blender">Blender</a></h1>
<h3 id="install-addon"><a class="header" href="#install-addon">Install Addon</a></h3>
<ol>
<li>copy 'tools/blender/io_export_chrisslymesh.py' to 'C:\Program Files\Blender Foundation\Blender 3.1\3.1\scripts\addons'</li>
<li>in Blender go to 'Edit -&gt; Preferences -&gt; Add-ons' and check 'Import-Export ChrisslyEngine-Mesh format(.mesh)'</li>
</ol>
<h3 id="export-directly-to-mesh-material-skeleton-and-tex-using-the-addon"><a class="header" href="#export-directly-to-mesh-material-skeleton-and-tex-using-the-addon">Export directly to (.mesh), (.material), (.skeleton) and (.tex) using the addon</a></h3>
<ul>
<li>textures will be exported in R8G8B8A8 format</li>
<li>axis_conversion(to_forward='-Z', to_up='+Y') on static meshes and morph animations, but not on skeletal animations</li>
<li>modifiers are not applied (to apply: 'Object Mode -&gt; Object -&gt; Apply -&gt; All Transforms')</li>
<li>for a custom gpu program:
<ol>
<li>select material</li>
<li>'Custom Properties -&gt; New'</li>
<li>name the new property 'gpu_program' and select 'String' as type</li>
<li>set value (like &quot;skybox.fx&quot;)</li>
<li>after export your (.material) file will contain a line 'gpu_program &quot;skybox.fx&quot;' in the pass section</li>
</ol>
</li>
</ul>
<h3 id="export-to-obj-for-later-conversion-with-the-mesh-cl-tool"><a class="header" href="#export-to-obj-for-later-conversion-with-the-mesh-cl-tool">Export to &quot;obj&quot; for later conversion with the mesh cl tool</a></h3>
<p>Options blender &quot;obj&quot; exporter for animations:</p>
<ul>
<li>'Animations'</li>
<li>'Triangulate'</li>
</ul>
<h3 id="skeletal-animation-setup"><a class="header" href="#skeletal-animation-setup">Skeletal Animation Setup</a></h3>
<p>In order to work correctly in the engine there are a few necessities when setting up the rig and animations:</p>
<ul>
<li>limit weights per vertex to 4 (in 'Weight Paint' mode: 'Weights -&gt; Limit Total')</li>
<li>normalise weights so all weights of a vertex sum up to 1 (in 'Weight Paint' mode: 'Weights -&gt; Normalize All')</li>
<li>in 'Pose Mode' set the bones transform mode to: &quot;Quaternion (WXYZ)&quot;</li>
<li>apply transform if the mesh was moved</li>
<li>always insert 'LocRot' to <code>all</code> channels (scale not supported)</li>
</ul>
<h3 id="about-coordinate-systems"><a class="header" href="#about-coordinate-systems">About Coordinate Systems</a></h3>
<p>Blender (forward is -Y and Up is +Z)</p>
<pre><code class="language-cpp">+Z
^    +Y
|   /
|  /
| /
|/
+--------&gt; +X
</code></pre>
<p>OpenGL Right-handed (forward is -Z and Up is +Y)</p>
<pre><code class="language-cpp">+Y
^    -Z
|   /
|  /
| /
|/
+--------&gt; +X
</code></pre>
<p>That's why the exporter transforms the vertices with axis_conversion(to_forward='-Z', to_up='+Y').</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="rawtex-gimp-plugin"><a class="header" href="#rawtex-gimp-plugin">RAWTex Gimp Plugin</a></h1>
<h3 id="install"><a class="header" href="#install">Install</a></h3>
<ul>
<li>get plugin <a href="https://github.com/hitchhikr/rawtex">here</a></li>
<li>copy 'RAWTex.exe' to 'C:\Users\username\AppData\Roaming\GIMP\2.10\plug-ins'</li>
</ul>
<h3 id="usage"><a class="header" href="#usage">Usage</a></h3>
<ol>
<li>'File -&gt; Export As...'</li>
<li>'Select File Type (By Extension) -&gt; RAW Texture'</li>
<li>'Save'</li>
<li>choose options and 'OK'</li>
</ol>
<h4 id="windows"><a class="header" href="#windows">Windows</a></h4>
<ul>
<li>don't mirror image vertical (except for DXT1-5, the plugin mirrors the texture when exporting to Standard OpenGL)</li>
<li>DXT Format: Standard OpenGL (otherwise colors are scrambled)</li>
</ul>
<h4 id="psp"><a class="header" href="#psp">PSP</a></h4>
<ul>
<li>mirror image vertical (Paint)</li>
<li>DXT Format: PSP</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gimp"><a class="header" href="#gimp">Gimp</a></h1>
<h3 id="add-alpha-channel"><a class="header" href="#add-alpha-channel">Add alpha channel</a></h3>
<ul>
<li>&quot;Colours -&gt; Colour to Alpha...&quot;</li>
</ul>
<h3 id="extract-alpha-to-single-png-useful-when-using-a-separate-compressed-texture-for-the-alpha-channel-on-android"><a class="header" href="#extract-alpha-to-single-png-useful-when-using-a-separate-compressed-texture-for-the-alpha-channel-on-android">Extract alpha to single png (useful when using a separate compressed texture for the alpha channel on android)</a></h3>
<ol>
<li>&quot;Colours -&gt; Components -&gt; Decompose...&quot; (&quot;RGBA&quot;, uncheck &quot;Decompose to Layers...&quot;)</li>
<li>right click on image and &quot;Export As...&quot;</li>
</ol>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-tools"><a class="header" href="#command-line-tools">Command line tools</a></h1>
<h2 id="texturetool"><a class="header" href="#texturetool">Texturetool</a></h2>
<h3 id="usage-1"><a class="header" href="#usage-1">Usage</a></h3>
<h4 id="android-1"><a class="header" href="#android-1">Android</a></h4>
<h5 id="how-to-use-etc1tool-to-export-compressed-textures"><a class="header" href="#how-to-use-etc1tool-to-export-compressed-textures">How to use etc1tool to export compressed textures</a></h5>
<p>Export with pkm header and pass '-pkm' to hint texturetool to parse properties from pkm header:</p>
<pre><code class="language-bash">etc1tool.exe mage.png
texturetool.exe -pkm -data mage.pkm -out mage_etc1.tex
</code></pre>
<p>Or only export payload using '--encodeNoHeader' and explicitly pass properties:</p>
<pre><code class="language-bash">etc1tool.exe mage.png --encodeNoHeader
texturetool.exe -format PF_ETC1_RGB8 -width 256 -height 256 -data mage_etc1.raw -out mage_etc1.tex
</code></pre>
<h2 id="meshtool"><a class="header" href="#meshtool">Meshtool</a></h2>
<h3 id="usage-2"><a class="header" href="#usage-2">Usage</a></h3>
<h4 id="export-morph-animations-example"><a class="header" href="#export-morph-animations-example">Export morph animations example</a></h4>
<pre><code class="language-bash">meshtool.exe -morphanim -length 3.0 -numKeys 31 -src %SrcFolder%\cerberus\cerberus_walk -dst %DstFolder%\cerberus_walk.mesh
</code></pre>
<p>For the call above the following filestructure is expected (this is how Blender's obj exporter outputs animations):</p>
<pre><code class="language-bash">+-- cerberus
|   +-- cerberus_walk1.obj    &lt;- starts with index 1 !
|   +-- cerberus_walk2.obj
|   +-- ...
|   +-- cerberus_walk31.obj
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="leveleditor"><a class="header" href="#leveleditor">Leveleditor</a></h1>
<p><img src="toolchain/../screenshots/leveleditor.jpg" alt="leveleditor" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="engine"><a class="header" href="#engine">Engine</a></h1>
<p>The engine consists of the following subsystems:</p>
<ul>
<li>Core</li>
<li>Graphics</li>
<li>Audio</li>
<li>Input</li>
<li>Application</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="graphics-1"><a class="header" href="#graphics-1">Graphics</a></h1>
<p>The subsystem responsible for rendering and animation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mesh-format"><a class="header" href="#mesh-format">Mesh-Format</a></h1>
<pre><code class="language-cpp">Tag                         Bytes       Type
M_MESH_BOUNDS               1           unsigned char
  bounding-radius           4           float

M_SUBMESH                   1           unsigned char
  materialname-length       1           unsigned char
  materialname-data         1 - 255     char
  vertex-count              4           unsigned int
  bytes-per-vertex          4           unsigned int
  texture coordinates       8           float
  color                     4           int
  normal                    12          float
  postition                 12          float

M_ANIMATION                 1           unsigned char
  anim-length               4           float

M_ANIMATION_TRACK           1           unsigned char
  handle(submesh-index)     1           unsigned char

M_ANIMATION_MORPH_KEYFRAME  1           unsigned char
  key-timestamp             4           float
  vertex-count              4           unsigned int
  bytes-per-vertex          4           unsigned int
  texture coordinates       8           float
  color                     4           int
  normal                    12          float
  postition                 12          float

M_MESH_SKELETON_FILE        1           unsigned char
  skeletonfilepath-length   1           unsigned char
  skeletonfilepath-data     1 - 255     char
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="material-format"><a class="header" href="#material-format">Material-Format</a></h1>
<pre><code class="language-cpp">material &quot;name&quot;
{
  pass
  {
      fog_override false
      fog_override true &lt;red green blue start end&gt;

      lighting on|off
      emissive vertexcolour
      emissive &lt;red green blue alpha&gt;
      ambient vertexcolour
      ambient &lt;red green blue alpha&gt;
      diffuse vertexcolour
      diffuse &lt;red green blue alpha&gt;
      specular vertexcolour
      specular &lt;red green blue alpha shininess&gt;

      scene_blend one|zero|dest_colour|src_colour|one_minus_dest_colour|one_minus_src_colour|dest_alpha|src_alpha|one_minus_dest_alpha|one_minus_src_alpha
                  one|zero|dest_colour|src_colour|one_minus_dest_colour|one_minus_src_colour|dest_alpha|src_alpha|one_minus_dest_alpha|one_minus_src_alpha
      scene_blend fix fix &lt;red green blue&gt; &lt;red green blue&gt;

      cull_hardware none|clockwise|anticlockwise

      depth_check on|off
      depth_write on|off

      texture_unit
      {
          texture &quot;filename.tex&quot;
          cubic_texture &quot;basefilename.tex&quot; // you'll have to provide the following 6 files: &quot;basefilename_px.tex&quot; &quot;basefilename_nx.tex&quot; &quot;basefilename_py.tex&quot; &quot;basefilename_ny.tex&quot; &quot;basefilename_pz.tex&quot; &quot;basefilename_nz.tex&quot;

          colour_op replace|add|alpha_blend|decal alpha

          filtering none|point|linear none|point|linear none|point|linear

          scroll &lt;u&gt; &lt;v&gt;
          scale &lt;u&gt; &lt;v&gt;

          env_map spherical
      }

      gpu_program &quot;gpuprogramname&quot;
  }
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="texture-format"><a class="header" href="#texture-format">Texture-Format</a></h1>
<p>A texture file contains a header (see below) followed by the payload.</p>
<pre><code class="language-cpp">Tag             Bytes       Type
format          1           unsigned char
width           2           unsigned short
height          2           unsigned short
numMipmaps      1           unsigned char
swizzled        1           unsigned char
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="skeleton-animation-format"><a class="header" href="#skeleton-animation-format">Skeleton-Animation-Format</a></h1>
<pre><code class="language-cpp">skeleton
{
    num_bones &lt;n&gt;
    bone &quot;Bonename&quot;
    {
        index &lt;i&gt;
        parent &lt;p&gt;
        local_matrix &lt;m00 , m01, m02, m03, m10 , m11, m12, m13, m20 , m21, m22, m23, m30 , m31, m32, m33&gt;
        inv_model_matrix &lt;m00 , m01, m02, m03, m10 , m11, m12, m13, m20 , m21, m22, m23, m30 , m31, m32, m33&gt;
    }
    bone &quot;AnotherBone&quot;
    {
        ...
    }
}

animation &quot;Animationname&quot;
{
    length &lt;l&gt;
    num_keyframes &lt;n&gt;
    track &quot;Trackname&quot;
    {
        index &lt;i&gt;
        key
        {
            time &lt;t&gt;
            local_matrix &lt;m00 , m01, m02, m03, m10 , m11, m12, m13, m20 , m21, m22, m23, m30 , m31, m32, m33&gt;
        }
        key
        {
            ...
        }
    }
    track &quot;AnotherTrack&quot;
    {
        ...
    }
}
animation &quot;AnotherAnimation&quot;
{
    ...
}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="cubemaps"><a class="header" href="#cubemaps">Cubemaps</a></h1>
<p>Naming convention for the files:</p>
<pre><code class="language-cpp">cubemap_px.tex
cubemap_nx.tex
cubemap_py.tex
cubemap_ny.tex
cubemap_pz.tex
cubemap_nz.tex
</code></pre>
<p>Load cubemap:</p>
<pre><code class="language-cpp">Texture* cubeMap = TextureManager::Instance()-&gt;Load(&quot;cubemap.tex&quot;, TEX_TYPE_CUBE_MAP);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="shadows"><a class="header" href="#shadows">Shadows</a></h1>
<h3 id="texture-based-shadows-current-limitations"><a class="header" href="#texture-based-shadows-current-limitations">Texture-based shadows current limitations</a></h3>
<ul>
<li>general
<ul>
<li>only a single spotlight can cast shadows</li>
</ul>
</li>
<li>d3d11 rendersystem
<ul>
<li>skeletal animated entities can neither cast nor receive shadows</li>
<li>morph animated entities can cast but not receive shadows</li>
<li>shadowmap resolution: 1024x1024</li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="built-in-default-shaders"><a class="header" href="#built-in-default-shaders">Built-in Default Shaders</a></h1>
<p>Light attenuation:</p>
<pre><code class="language-cpp">Formula: attenuation = 1.0f / (constant + linear * distance + quadratic * distance²)
</code></pre>
<p>Auto updated shader parameters:</p>
<pre><code class="language-cpp">&quot;worldMatrix&quot;
&quot;viewMatrix&quot;
&quot;projectionMatrix&quot;
&quot;worldViewProjMatrix&quot;
&quot;textureMatrix&quot;
&quot;morphWeight&quot;
</code></pre>
<p>Default light params matrix:</p>
<pre><code class="language-cpp">[ posx    posy    posz        -           ] position
[ diff.r  diff.g  diff.b      -           ] diffuse
[ spec.r  spec.g  spec.b      shininess   ] spec
[ const   linear  quadratic   range       ] attenuation
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="create-mesh-programmatically"><a class="header" href="#create-mesh-programmatically">Create mesh programmatically</a></h1>
<pre><code class="language-cpp">Mesh* mesh = MeshManager::Instance()-&gt;CreateManual(&quot;mytrianglemesh&quot;);
SubMesh* subMesh = mesh-&gt;CreateSubMesh();
HardwareVertexBuffer* vertexBuffer = CE_NEW HardwareVertexBuffer(3U, 36U, HBU_STATIC, false);
void* buffer = vertexBuffer-&gt;Map();
chrissly::graphics::Vertex vtxData[3U] =
{
    {0.0f, 0.0f, 0xffffffff, 0.0f, 0.0f, 1.0f, -0.5f , -0.5f, 0.0f},
    {0.0f, 0.0f, 0xffffffff, 0.0f, 0.0f, 1.0f,  0.5f , -0.5f, 0.0f},
    {0.0f, 0.0f, 0xffffffff, 0.0f, 0.0f, 1.0f,  0.0f ,  0.5f, 0.0f}
};
memcpy(buffer, vtxData, sizeof(vtxData));
vertexBuffer-&gt;Unmap();
subMesh-&gt;vertexData = CE_NEW VertexData(vertexBuffer);
subMesh-&gt;SetMaterialName(&quot;green_material&quot;);
subMesh-&gt;topology = PT_TRIANGLELIST;
Entity* entity = SceneManager::Instance()-&gt;CreateEntity(&quot;mytrianglemesh&quot;);
SceneNode* sceneNode-&gt;AttachObject(entity);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="animation-system-gotchas"><a class="header" href="#animation-system-gotchas">Animation System Gotchas</a></h1>
<ul>
<li>a mesh can have either morph or skeletal animation, but not both</li>
<li>only one morphanimation (with hardcoded name &quot;default&quot;, get with: entity-&gt;GetAnimationState(&quot;default&quot;)) per mesh, blending multiple morphanimations is not supported</li>
<li>bone rotations are blended as follows:</li>
</ul>
<pre><code class="language-cpp">Quaternion q1 = Quaternion::Slerp(Quaternion::IDENTITY, rotation1, weight1);
Quaternion q2 = Quaternion::Slerp(Quaternion::IDENTITY, rotation2, weight2);
Quaternion blendedQ = q1 * q2;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        <script>
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>
        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
